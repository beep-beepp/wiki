# ğŸ§© DataConfiguration êµ¬ì„± ê°€ì´ë“œ

---

- **JPAë¥¼ ì“°ëŠ” í•œ, `JpaTransactionManager`ëŠ” ë¬´ì¡°ê±´ í•„ìš”**í•©ë‹ˆë‹¤.
- MyBatisê¹Œì§€ ê°™ì´ ì“°ëŠ” êµ¬ì¡°ë¼ë©´, ë³´í†µ ì•„ë˜ ë‘ ê°€ì§€ ë°©ë²• ì¤‘ í•˜ë‚˜ë¥¼ ì”ë‹ˆë‹¤:
    1. **JPAì™€ MyBatisê°€ ê°™ì€ DataSourceë¥¼ ê³µìœ ** â†’ `JpaTransactionManager` í•˜ë‚˜ë§Œ ë“±ë¡í•´ë„ ë¨ (âœ… ì¶”ì²œ)
    2. **ë³„ë„ì˜ DBë¥¼ ì“°ê±°ë‚˜ íŠ¸ëœì­ì…˜ì„ ë¶„ë¦¬** â†’ `JpaTransactionManager` + `DataSourceTransactionManager` ë‘˜ ë‹¤ ë“±ë¡

---

## 1ï¸âƒ£ `EntityManagerFactory.createEntityManager()` ë°©ì‹

- **EntityManagerë¥¼ ì§ì ‘ ìƒˆë¡œ ìƒì„±**í•´ì„œ `ExtendedJPAQueryFactory`ì— ë„£ì–´ì¤Œ.
- ì´ `EntityManager`ëŠ” **ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ê´€ë¦¬(@Transactional)ì™€ ì—°ê²°ë˜ì§€ ì•ŠìŒ** â†’ ìŠ¤ìŠ¤ë¡œ ì—´ê³  ë‹«ëŠ” ê´€ë¦¬ ì±…ì„ì´ í•„ìš”.
- íŠ¸ëœì­ì…˜ ê²½ê³„ ë°–ì—ì„œ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘ ê°€ëŠ¥í•˜ì§€ë§Œ, **flush/rollback ë™ê¸°í™”ê°€ ì•ˆ ëœë‹¤**ëŠ” ë‹¨ì .
- ì˜ëª» ì“°ë©´ **"Transaction required"** ê°™ì€ ì—ëŸ¬ ê°€ëŠ¥.

| í•­ëª© | ì„¤ëª… |
|------|------|
| íŠ¸ëœì­ì…˜ ì—°ë™ | âŒ ì§ì ‘ ê´€ë¦¬ í•„ìš” |
| flush/rollback | âŒ ìˆ˜ë™ |
| EntityManager ìˆ˜ëª… | ì§ì ‘ ê´€ë¦¬í•´ì•¼ í•¨ |
| ì‚¬ìš©ì²˜ | íŠ¸ëœì­ì…˜ê³¼ ë…ë¦½ëœ ì„¸ì…˜ í•„ìš” ì‹œ (ê±°ì˜ ì—†ìŒ) |

---

## 2ï¸âƒ£ `@PersistenceContext` ë°©ì‹ (ê¶Œì¥)

```java
@PersistenceContext(unitName = "headEntityManager")
private EntityManager entityManager;

@Bean
@Primary
public ExtendedJPAQueryFactory jpaQueryFactory() {
    return new ExtendedJPAQueryFactory(entityManager);
}
```

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ **íŠ¸ëœì­ì…˜ë§ˆë‹¤ ì•Œë§ì€ EntityManagerë¥¼ ì£¼ì…**í•´ì¤Œ.
- `@Transactional` ê²½ê³„ ì•ˆì—ì„œ ë™ì‘ ì‹œ ìë™ìœ¼ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸, flush/rollbackê³¼ ì—°ë™ë¨.
- ëŒ€ë¶€ë¶„ì˜ ì‹¤ë¬´ ì¼€ì´ìŠ¤ì—ì„œ ì´ ë°©ì‹ì´ ì•ˆì •ì ì´ê³  ê¶Œì¥.

| í•­ëª© | ì„¤ëª… |
|------|------|
| íŠ¸ëœì­ì…˜ ì—°ë™ | âœ… ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ìë™ ì—°ë™ |
| flush/rollback | âœ… ìë™ |
| EntityManager ìˆ˜ëª… | ìŠ¤í”„ë§ì´ íŠ¸ëœì­ì…˜ ë²”ìœ„ì— ë§ê²Œ ê´€ë¦¬ |
| ì¶”ì²œ ì—¬ë¶€ | âœ”ï¸ ì¼ë°˜ì ì´ê³  ê¶Œì¥ |

---

## âœ… ì°¨ì´ ìš”ì•½

| êµ¬ë¶„ | `createEntityManager()` ë°©ì‹ | `@PersistenceContext` ë°©ì‹ |
|------|------------------------------|-----------------------------|
| íŠ¸ëœì­ì…˜ ì—°ë™ | âŒ ì§ì ‘ ê´€ë¦¬ í•„ìš” | âœ… ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ìë™ ì—°ë™ |
| flush/rollback | âŒ ìˆ˜ë™ | âœ… ìë™ |
| EntityManager ìˆ˜ëª… | ì§ì ‘ ê´€ë¦¬ | ìŠ¤í”„ë§ì´ ê´€ë¦¬ |
| ì¶”ì²œ ì—¬ë¶€ | íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ | âœ”ï¸ ì‹¤ë¬´ ê¸°ë³¸ |

---

## ğŸš€ ê²°ë¡ 

- ì‹¤ë¬´ì—ì„œ `@Transactional` ê¸°ë°˜ ì„œë¹„ìŠ¤/ë¦¬í¬ì§€í† ë¦¬ë¼ë©´  
  **`@PersistenceContext` ë°©ì‹ì´ ì •ë‹µ**ì…ë‹ˆë‹¤.
- `createEntityManager()`ëŠ” **ë…ë¦½ì ì¸ ì„¸ì…˜(íŠ¸ëœì­ì…˜ ë¬´ê´€)** ì„ ì›í•  ë•Œë§Œ ì‚¬ìš© (ê±°ì˜ ì•ˆ ì”€).

