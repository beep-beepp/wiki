# Transaction Isolation Level ì •ë¦¬

Isolation Levelì€ â€œë…¼ë¦¬ì  ì¼ê´€ì„± ë³´ì¥ ê·œì¹™(Logical Isolation Rule)â€ì´ë‹¤.

ì¦‰, DBê°€ **íŠ¸ëœì­ì…˜ ê°„ì— ì–´ë–¤ ë°ì´í„°ë¥¼ ì–¸ì œ ë³´ì—¬ì¤„ì§€ ê²°ì •í•˜ëŠ” ê·œì•½**ì¼ ë¿ì´ë©°,  
ê·¸ê±¸ êµ¬í˜„í•˜ê¸° ìœ„í•´ DBë§ˆë‹¤ ë‹¤ë¥¸ **Lock / MVCC ì „ëµ**ì„ ì‚¬ìš©í•œë‹¤.

- ë¬¼ë¦¬ì  Lockì€ â€œë™ì‹œ ì ‘ê·¼ì„ ë§‰ëŠ” ë©”ì»¤ë‹ˆì¦˜(ë°°íƒ€ì  ì ‘ê·¼)â€
- Isolation Levelì€ â€œë™ì‹œ ì ‘ê·¼ ì¤‘ ì–´ë–¤ í˜„ìƒ(Dirty Read ë“±)ì„ í—ˆìš©í• ì§€â€ë¥¼ ì •ì˜

> Isolation Levelì€ â€˜ì •ì±…â€™, Lockì€ â€˜ìˆ˜ë‹¨â€™  
> DBëŠ” ì´ ì •ì±…ì„ ì§€í‚¤ê¸° ìœ„í•´ Lockì´ë‚˜ Snapshot(MVCC)ì„ ì¡°í•©í•´ ì‚¬ìš©í•¨.

---

## ğŸ”’ Lock vs Isolation

| êµ¬ë¶„ | Lock | Isolation Level |
|------|------|----------------|
| ê°œë… | ì‹¤ì œë¡œ ë°ì´í„° ì ‘ê·¼ì„ ë§‰ëŠ” ë©”ì»¤ë‹ˆì¦˜ | ì–´ë–¤ í˜„ìƒê¹Œì§€ í—ˆìš©í• ì§€ ê·œì •í•˜ëŠ” ë…¼ë¦¬ ë ˆë²¨ |
| ë‹¨ìœ„ | ROW, í˜ì´ì§€, í…Œì´ë¸” ë‹¨ìœ„ | íŠ¸ëœì­ì…˜ ë‹¨ìœ„ |
| ëª©ì  | ë™ì‹œì„± ì œì–´(ë°°íƒ€ì  ì ‘ê·¼) | ì¼ê´€ì„± ì œì–´(ì½ê¸° ì‹œì  ë³´ì¥) |
| êµ¬í˜„ | DB Lock Manager | DB Engineì˜ Isolation Policy |
| ì˜ˆì‹œ | Row-level X Lock | READ COMMITTED, REPEATABLE READ |

---

## ğŸ§© Isolationì˜ ì¢…ë¥˜

| Level | Dirty Read | Non-repeatable Read | Phantom Read | ì„¤ëª… |
|--------|-------------|--------------------|---------------|------|
| READ UNCOMMITTED | í—ˆìš©ë¨ | í—ˆìš©ë¨ | í—ˆìš©ë¨ | ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë„ ì½ìŒ. ê±°ì˜ ì•ˆ ì”€ |
| READ COMMITTED | âŒ | í—ˆìš©ë¨ | í—ˆìš©ë¨ | ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ì½ìŒ (ê°€ì¥ ì¼ë°˜ì ) |
| REPEATABLE READ | âŒ | âŒ | DBë§ˆë‹¤ ë‹¤ë¦„ | ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ ê°™ì€ í–‰ ì¬ì¡°íšŒ ì‹œ ê²°ê³¼ ë™ì¼ |
| SERIALIZABLE | âŒ | âŒ | âŒ | ì™„ì „ ì§ë ¬í™”. ì„±ëŠ¥ ê°€ì¥ ë‚®ìŒ |

---

## ğŸ“˜ Read í˜„ìƒ ì •ë¦¬

- **Dirty Read**  
  ì»¤ë°‹ë˜ì§€ ì•Šì€ íŠ¸ëœì­ì…˜ì˜ ë³€ê²½ ë‚´ìš©ì„ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì½ëŠ” í˜„ìƒ.  
  ì˜ˆ: Aê°€ value=5 â†’ 3ìœ¼ë¡œ ìˆ˜ì • ì¤‘ì¸ë° ì»¤ë°‹ ì „, Bê°€ ê·¸ ê°’ì„ ì½ìŒ.

- **Non-repeatable Read**  
  í•œ íŠ¸ëœì­ì…˜ì—ì„œ ê°™ì€ ì¿¼ë¦¬ë¥¼ ë‘ ë²ˆ ì‹¤í–‰í–ˆì„ ë•Œ, ì¤‘ê°„ì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë°ì´í„°ë¥¼ ìˆ˜ì •Â·ì»¤ë°‹í•˜ì—¬ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ” í˜„ìƒ.

- **Phantom Read**  
  í•œ íŠ¸ëœì­ì…˜ ë‚´ ê°™ì€ ì¡°ê±´ì˜ SELECTë¥¼ ë°˜ë³µí–ˆì„ ë•Œ, ì¤‘ê°„ì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ INSERT/DELETEí•´ì„œ ê²°ê³¼ í–‰ ìˆ˜ê°€ ë‹¬ë¼ì§€ëŠ” í˜„ìƒ.

---

## âš™ï¸ Isolationë³„ ë™ì‘ ì •ë¦¬

**ì¡°ê±´:**
- DB ê¸°ë³¸ ì„¤ì • (Oracle, PostgreSQL ê¸°ì¤€)
- Springì—ì„œ `@Transactional(isolation=?)`ìœ¼ë¡œë§Œ ê²©ë¦¬ìˆ˜ì¤€ ì§€ì •
- DB ë½ ì •ì±…ì€ ê¸°ë³¸

Aì™€ Bê°€ `data=5`ë¥¼ ë™ì‹œì— ì ‘ê·¼í•  ë•Œ,
- A: ì¡°íšŒ í›„ value=3ìœ¼ë¡œ ë³€ê²½
- B: ì¡°íšŒ í›„ value=8ìœ¼ë¡œ ë³€ê²½
- Aê°€ ë¨¼ì € ì§„ì…

---

### 1ï¸âƒ£ ì¡°íšŒ í›„ UPDATE (SELECT â†’ UPDATE)

#### ğŸ”¹ READ UNCOMMITTED
- Oracle / PostgreSQLì—ì„œëŠ” ë‚´ë¶€ì ìœ¼ë¡œ READ COMMITTEDë¡œ ë™ì‘ (Dirty Read ë¶ˆê°€)
- MySQLì—ì„œëŠ” Dirty Read ê°€ëŠ¥ (Aì˜ ë¯¸ì»¤ë°‹ ë°ì´í„° ì½ì„ ìˆ˜ ìˆìŒ)
- í•˜ì§€ë§Œ UPDATE ì‹œì ì—ëŠ” Aì˜ X-lock ë•Œë¬¸ì— ëŒ€ê¸° ë°œìƒ
- **ê²°ê³¼:** A ì„±ê³µ, BëŠ” A ì»¤ë°‹ í›„ ì¡°ê±´ ë¶ˆì¼ì¹˜ë¡œ 0 rows updated

---

#### ğŸ”¹ READ COMMITTED
- ê° ì¿¼ë¦¬ë§ˆë‹¤ ìµœì‹  ì»¤ë°‹ëœ ë°ì´í„°ë¥¼ ì½ìŒ (statement-level snapshot)
- BëŠ” Aê°€ ì»¤ë°‹ëœ ì´í›„ value=3ì„ ë³´ê²Œ ë¨
- **ê²°ê³¼:** A ì„±ê³µ, BëŠ” ì¡°ê±´ ë¶ˆì¼ì¹˜ (0 rows updated, ì •ìƒ ì»¤ë°‹)

---

#### ğŸ”¹ REPEATABLE READ
> DBë§ˆë‹¤ êµ¬í˜„ì´ ë‹¤ë¥´ë‹¤

| DB | êµ¬í˜„ ë°©ì‹ | Bì˜ ê²°ê³¼ |
|----|------------|-----------|
| PostgreSQL | Snapshot Isolation (MVCC) | A ì»¤ë°‹ í›„ B ì»¤ë°‹ ì‹œì  ì¶©ëŒ ê°ì§€ â†’ **serialization failure (rollback)** |
| MySQL (InnoDB) | Lock ê¸°ë°˜ (next-key lock) | BëŠ” A ì»¤ë°‹ê¹Œì§€ **ëŒ€ê¸° í›„ 0 rows updated** |
| Oracle | ë¯¸ì§€ì› (READ COMMITTEDë¡œ ë™ì‘) | ë™ì¼í•˜ê²Œ 0 rows updated |

**ìš”ì•½:**
- PostgreSQL â†’ rollback ë°œìƒ
- MySQL / Oracle â†’ ëŒ€ê¸° í›„ 0 rows updated

---

#### ğŸ”¹ SERIALIZABLE
- ì™„ì „ ì§ë ¬í™” ë³´ì¥
- ë™ì‹œ ì»¤ë°‹ ë¶ˆê°€ â†’ DBê°€ ì¶©ëŒ ê°ì§€ ì‹œ B ë¡¤ë°±
- **ê²°ê³¼:** Aë§Œ ì»¤ë°‹ ì„±ê³µ, BëŠ” serialization failure (rollback)

---

âœ… **ê²°ë¡ **

| êµ¬ë¶„ | ê²°ê³¼ ìš”ì•½ |
|------|------------|
| **READ COMMITTED ì´í•˜** | BëŠ” ì¡°ê±´ ë¶ˆì¼ì¹˜ (Aê°€ ì´ê¹€)ë¡œ ì—…ë°ì´íŠ¸ ì—†ì´ ì •ìƒ ì¢…ë£Œ |
| **REPEATABLE READ ì´ìƒ** | BëŠ” snapshot ì¶©ëŒë¡œ serialization failure â†’ ROLLBACK & ì˜ˆì™¸ ë°œìƒ |

---

### 2ï¸âƒ£ ë‹¨ìˆœ ì¡°ê±´ UPDATE (UPDATE WHERE value=5)

| Isolation Level | ê²°ê³¼ ìš”ì•½ |
|-----------------|------------|
| READ UNCOMMITTED | B ëŒ€ê¸° í›„ 0 rows updated |
| READ COMMITTED | B ëŒ€ê¸° í›„ 0 rows updated |
| REPEATABLE READ | B ëŒ€ê¸° í›„ 0 rows updated (PostgreSQL ì œì™¸) |
| SERIALIZABLE | Aë§Œ ì»¤ë°‹ ì„±ê³µ, BëŠ” rollback (ì¶©ëŒ ê°ì§€) |

âœ… **ê²°ë¡ :**  
Isolation Levelì— ìƒê´€ì—†ì´ Aê°€ ë¨¼ì € ì»¤ë°‹ â†’ BëŠ” ëŒ€ê¸° í›„ ì¡°ê±´ ë¶ˆì¼ì¹˜ (0 rows).  
ë‹¨, SERIALIZABLE / PostgreSQL REPEATABLE READì—ì„œëŠ” ì¶©ëŒ ê°ì§€ ì‹œ Bê°€ rollback.

---

ğŸ“ **ìµœì¢… ìš”ì•½**

| ì¼€ì´ìŠ¤ | READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE |
|---------|------------------|----------------|-----------------|---------------|
| ì¡°íšŒ í›„ UPDATE | A ì„±ê³µ, B ì¡°ê±´ ë¶ˆì¼ì¹˜ | A ì„±ê³µ, B ì¡°ê±´ ë¶ˆì¼ì¹˜ | (PG) rollback / (MySQLÂ·Oracle) 0 rows | A ì„±ê³µ, B rollback |
| ì¡°ê±´ UPDATE | A ì„±ê³µ, B 0 rows | A ì„±ê³µ, B 0 rows | A ì„±ê³µ, B 0 rows | A ì„±ê³µ, B rollback |

---

> **ìš”ì•½ ë¬¸ì¥:**  
> ì˜¤ë¼í´Â·PostgreSQLì˜ ê¸°ë³¸(READ COMMITTED)ì—ì„œëŠ” Aê°€ ë¨¼ì € ì»¤ë°‹í•˜ë©´ BëŠ” ì¡°ê±´ ë¶ˆì¼ì¹˜ë¡œ ì •ìƒ ì¢…ë£Œëœë‹¤.
>
> MySQL(InnoDB)ì—ì„œëŠ” REPEATABLE READ ì‹œ Bê°€ ëŒ€ê¸° í›„ 0 rows updatedë¡œ ëë‚˜ì§€ë§Œ,  
> PostgreSQLì—ì„œëŠ” REPEATABLE READ ì´ìƒì—ì„œ MVCC snapshot ì¶©ëŒì´ ê°ì§€ë˜ì–´ Bê°€ **serialization failureë¡œ rollback**ëœë‹¤.
