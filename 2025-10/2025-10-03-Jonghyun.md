# Pool Connection

1. **DB Connection Pool(연결 풀, DBCP)이란?**
    - 애플리케이션(WAS)과 데이터베이스(DB) 서버 간에 커넥션을 **매번 새로 생성하고 닫는 것**은 비용이 크고 성능 저하의 원인이 됨.
    - 그래서 미리 일정량의 커넥션을 만들어 “풀(Pool)”에 저장해두고, 요청이 오면 이 풀에서 가져다 사용하고, 사용 후에는 풀로 반납하는 방식이 효율적임.
    - 이 방식이 바로 DBCP (Database Connection Pool)임.
2. **왜 DBCP를 써야 하나?**
    - 네트워크 연결(3-way handshake 등) = 시간이 걸림. 매 요청마다 DB 커넥션 생성/해제하면 병목이 생김.
    - 커넥션 풀을 사용하면 커넥션 객체 재사용이 가능해져, 응답 속도 향상 및 리소스 낭비 감소됨.
3. **풀 설정 시 중요한 옵션들 ( MySQL / HikariCP )**
    - **maximumPoolSize**: 풀에서 유지할 수 있는 최대 커넥션 수 (Idle + Active 포함)
    - **minimumIdle**: 최소 유지할 유휴 커넥션 수. 풀 크기를 고정하는 데 유리.
    - **maxLifetime**: 커넥션이 풀에 머무를 수 있는 최대 시간. DB의 wait_timeout 보다 짧게 설정하는 것이 좋음.
    - **connectionTimeout**: 커넥션 요청 후 기다릴 수 있는 최대시간. 너무 길면 사용자 요청 응답이 늦어질 수 있음.
    - **idleTimeout**: 유휴 상태로 머무르는 최대 시간. 설정 안 하면 유휴 커넥션이 불필요하게 유지될 수 있음.
    - **readOnly**, **connectionTestQuery** 등 추가 옵션도 있음.
4. **운영 시 나타날 수 있는 이슈**
    - minimumIdle < maximumPoolSize 인 경우, 트래픽 몰릴 때마다 풀 확장이 반복되고 다시 축소됨 → 성능 저하 가능성.
    - 커넥션 누수(leak) 발생: 쿼리 후에 커넥션이 반환되지 않으면 활성 상태에서 남아있고, 결국 커넥션 부족 상태가 됨.
    - DB 서버의 wait_timeout이 짧고 커넥션 maxLifetime이 더 길면, 풀은 살아있지만 실제 DB 커넥션은 닫혀있는 상태가 되어 오류 유발 가능.