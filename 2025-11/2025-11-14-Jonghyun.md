# ìë°” ì˜ì†ì„±(JPA)

## ğŸ“š ëª©ì°¨
1. [ì˜ì†ì„± ê¸°ë³¸ ê°œë…](#1-ì˜ì†ì„±-ê¸°ë³¸-ê°œë…)
2. [ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸](#2-ì˜ì†ì„±-ì»¨í…ìŠ¤íŠ¸)
3. [ìŠ¤ëƒ…ìƒ·ê³¼ ë³€ê²½ ê°ì§€](#3-ìŠ¤ëƒ…ìƒ·ê³¼-ë³€ê²½-ê°ì§€)
4. [persistì˜ ì—­í• ](#4-persistì˜-ì—­í• )
5. [flush vs commit](#5-flush-vs-commit)
6. [@Transactional ë™ì‘ ì›ë¦¬](#6-transactional-ë™ì‘-ì›ë¦¬)
7. [íŠ¸ëœì­ì…˜ ì „íŒŒ(Propagation)](#7-íŠ¸ëœì­ì…˜-ì „íŒŒpropagation)
8. [LazyInitializationException í•´ê²°](#8-lazyinitializationexception-í•´ê²°)

---

## 1. ì˜ì†ì„± ê¸°ë³¸ ê°œë…

### ì˜ì†ì„±(Persistence)ì´ë€?
**ë°ì´í„°ë¥¼ ìƒì„±í•œ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë˜ì–´ë„ ë°ì´í„°ê°€ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ” íŠ¹ì„±**

### ì—”í‹°í‹°ì˜ 4ê°€ì§€ ìƒíƒœ

```java
// 1. ë¹„ì˜ì† (New/Transient) - JPAê°€ ëª¨ë¦„
User user = new User("í™ê¸¸ë™");

// 2. ì˜ì† (Managed) - JPAê°€ ê´€ë¦¬
em.persist(user);

// 3. ì¤€ì˜ì† (Detached) - ê´€ë¦¬ ì¤‘ë‹¨
em.detach(user);

// 4. ì‚­ì œ (Removed)
em.remove(user);
```

### ì‹¤ë¬´ ì˜ˆì œ: ì‚¬ìš©ì ìƒì„±

```java
@Service
@RequiredArgsConstructor
public class UserService {
    
    private final EntityManager em;
    
    @Transactional
    public User createUser(String name, String email) {
        // ë¹„ì˜ì† ìƒíƒœ
        User user = new User(name, email);
        
        // ì˜ì† ìƒíƒœë¡œ ì „í™˜
        em.persist(user);
        
        // ìë™ìœ¼ë¡œ INSERT ì¿¼ë¦¬ ìƒì„±ë¨
        return user;
    }
}
```

---

## 2. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸

### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€?
**ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½. "ì—”í‹°í‹° ë§¤ë‹ˆì €"ë¥¼ í†µí•´ ì ‘ê·¼**

### 1ì°¨ ìºì‹œ

```java
@Transactional
public void cacheExample() {
    // ì²« ë²ˆì§¸ ì¡°íšŒ - DBì—ì„œ ê°€ì ¸ì˜´
    User user1 = em.find(User.class, 1L);
    // SELECT * FROM user WHERE id = 1
    
    // ë‘ ë²ˆì§¸ ì¡°íšŒ - 1ì°¨ ìºì‹œì—ì„œ ê°€ì ¸ì˜´ (ì¿¼ë¦¬ ì•ˆë‚˜ê°!)
    User user2 = em.find(User.class, 1L);
    
    // ë™ì¼ì„± ë³´ì¥
    System.out.println(user1 == user2);  // true
}
```

### ì“°ê¸° ì§€ì—° (Write-Behind)

```java
@Transactional
public void writeBehind() {
    User user1 = new User("í™ê¸¸ë™");
    User user2 = new User("ê¹€ì² ìˆ˜");
    User user3 = new User("ì´ì˜í¬");
    
    em.persist(user1);  // SQL ì €ì¥ì†Œì— ì¶”ê°€ë§Œ
    em.persist(user2);  // SQL ì €ì¥ì†Œì— ì¶”ê°€ë§Œ
    em.persist(user3);  // SQL ì €ì¥ì†Œì— ì¶”ê°€ë§Œ
    
    // ì—¬ê¸°ê¹Œì§€ DBì— ì¿¼ë¦¬ ì•ˆë‚˜ê°!
    
} // íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— í•œë²ˆì— ì‹¤í–‰
  // INSERT 3ë²ˆ ì‹¤í–‰
```

### ì‹¤ë¬´ ì˜ˆì œ: ëŒ€ëŸ‰ ì €ì¥ ìµœì í™”

```java
@Transactional
public void saveBatch(List<User> users) {
    for (int i = 0; i < users.size(); i++) {
        em.persist(users.get(i));
        
        // 100ê°œë§ˆë‹¤ flush (ë©”ëª¨ë¦¬ ê´€ë¦¬)
        if (i % 100 == 0) {
            em.flush();
            em.clear();
        }
    }
}
```

---

## 3. ìŠ¤ëƒ…ìƒ·ê³¼ ë³€ê²½ ê°ì§€

### ìŠ¤ëƒ…ìƒ·ì´ë€?
**ì—”í‹°í‹°ë¥¼ ì²˜ìŒ ì¡°íšŒí–ˆì„ ë•Œì˜ ìƒíƒœë¥¼ ë³µì‚¬í•´ì„œ ì €ì¥í•œ "ì›ë³¸"**

### ë³€ê²½ ê°ì§€ (Dirty Checking)

```java
@Transactional
public void updateUser(Long id) {
    // ì¡°íšŒ ì‹œì : ìŠ¤ëƒ…ìƒ· ì €ì¥
    User user = em.find(User.class, id);
    // ìŠ¤ëƒ…ìƒ·: {name: "í™ê¸¸ë™", email: "hong@test.com"}
    
    // ìˆ˜ì •
    user.setName("ê¹€ì² ìˆ˜");
    user.setEmail("kim@test.com");
    // í˜„ì¬: {name: "ê¹€ì² ìˆ˜", email: "kim@test.com"}
    // ìŠ¤ëƒ…ìƒ·: {name: "í™ê¸¸ë™", email: "hong@test.com"} (ê·¸ëŒ€ë¡œ)
    
    // save() í•„ìš”ì—†ìŒ!
    
} // ì»¤ë°‹ ì‹œì :
  // ìŠ¤ëƒ…ìƒ·ê³¼ ë¹„êµ â†’ ë³€ê²½ ê°ì§€
  // UPDATE user SET name='ê¹€ì² ìˆ˜', email='kim@test.com' WHERE id=?
```

### ì™œ ìŠ¤ëƒ…ìƒ·ì´ í•„ìš”í•œê°€?

```java
// âŒ ìŠ¤ëƒ…ìƒ· ì—†ë‹¤ë©´:
public void updateWithoutSnapshot(Long id) {
    User user = findUser(id);
    user.setName("ê¹€ì² ìˆ˜");
    
    // ê°œë°œìê°€ ì§ì ‘ UPDATE ì‘ì„±í•´ì•¼ í•¨
    jdbcTemplate.update(
        "UPDATE user SET name=? WHERE id=?",
        user.getName(), user.getId()
    );
}

// âœ… ìŠ¤ëƒ…ìƒ· ìˆìœ¼ë©´:
@Transactional
public void updateWithSnapshot(Long id) {
    User user = em.find(User.class, id);
    user.setName("ê¹€ì² ìˆ˜");
    
    // ë! ìë™ìœ¼ë¡œ UPDATE
}
```

### ì‹¤ë¬´ ì˜ˆì œ: ì£¼ë¬¸ ìƒíƒœ ë³€ê²½

```java
@Transactional
public void completeOrder(Long orderId) {
    Order order = em.find(Order.class, orderId);
    
    // ì—¬ëŸ¬ í•„ë“œ ìˆ˜ì •
    order.setStatus(OrderStatus.COMPLETED);
    order.setCompletedAt(LocalDateTime.now());
    order.addPoint(100);
    
    // ë³€ê²½ëœ í•„ë“œë§Œ ìë™ìœ¼ë¡œ UPDATE!
    // UPDATE orders SET 
    //   status='COMPLETED', 
    //   completed_at=?, 
    //   point=? 
    // WHERE id=?
}
```

---

## 4. persistì˜ ì—­í• 

### persist()ê°€ í•˜ëŠ” ì¼

```java
User user = new User("í™ê¸¸ë™");  // ë¹„ì˜ì† ìƒíƒœ
// - JPAê°€ ëª¨ë¦„
// - ID ì—†ìŒ
// - ë³€ê²½í•´ë„ DB ë°˜ì˜ ì•ˆë¨

em.persist(user);  // ì˜ì† ìƒíƒœë¡œ ì „í™˜
// âœ… 1ì°¨ ìºì‹œì— ì €ì¥
// âœ… ìŠ¤ëƒ…ìƒ· ìƒì„±
// âœ… SQL ì €ì¥ì†Œì— INSERT ì¶”ê°€
// âœ… ID ìƒì„±
// âœ… ë³€ê²½ ê°ì§€ ì‹œì‘
```

### persist ì „í›„ ë¹„êµ

```java
@Transactional
public void persistExample() {
    User user = new User("í™ê¸¸ë™");
    
    // persist ì „
    System.out.println(user.getId());  // null
    user.setName("ê¹€ì² ìˆ˜");  // ë°”ê¿”ë„ DBì™€ ë¬´ê´€
    
    // persist í›„
    em.persist(user);
    System.out.println(user.getId());  // 1 (ìƒì„±ë¨!)
    user.setName("ì´ì˜í¬");  // DBì— ë°˜ì˜ë¨!
    
} // INSERT INTO user (name) VALUES ('ì´ì˜í¬')
```

### ì‹¤ë¬´ ì˜ˆì œ: ì£¼ë¬¸ ìƒì„±

```java
@Transactional
public Order createOrder(Long userId, Long productId) {
    User user = em.find(User.class, userId);
    Product product = em.find(Product.class, productId);
    
    // 1. ì£¼ë¬¸ ê°ì²´ ìƒì„± (ë¹„ì˜ì†)
    Order order = new Order();
    order.setUser(user);
    order.setProduct(product);
    order.setStatus(OrderStatus.PENDING);
    
    // 2. ì˜ì†í™” (JPAê°€ ê´€ë¦¬ ì‹œì‘)
    em.persist(order);
    
    // 3. ì´í›„ ìˆ˜ì •ì€ ìë™ ë°˜ì˜
    order.setOrderNumber(generateOrderNumber());
    
    return order;
}
```

---

## 5. flush vs commit

### flush: SQL ì €ì¥ì†Œ â†’ DB ì „ì†¡

```java
@Transactional
public void flushExample() {
    User user = new User("í™ê¸¸ë™");
    em.persist(user);
    
    em.flush();  // â† ì´ ì‹œì ì— INSERT ì¿¼ë¦¬ ì‹¤í–‰ë¨!
    // í•˜ì§€ë§Œ ì•„ì§ "ì„ì‹œ"
    // - ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œëŠ” ëª»ë´„
    // - rollback ê°€ëŠ¥
    
    user.setName("ê¹€ì² ìˆ˜");
    
} // â† commit: ì˜êµ¬ ë°˜ì˜, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œë„ ë³´ì„
```

### flushì™€ commitì˜ ì°¨ì´

```
flush():
- SQL ì¿¼ë¦¬ë¥¼ DBë¡œ ì „ì†¡
- DBì—ì„œ ì‹¤í–‰ë¨
- í•˜ì§€ë§Œ "íŠ¸ëœì­ì…˜ ë‚´ë¶€"ì—ì„œë§Œ ìœ íš¨
- ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œëŠ” ì•ˆë³´ì„ (ê²©ë¦¬)
- rollback ê°€ëŠ¥

commit():
- íŠ¸ëœì­ì…˜ í™•ì •!
- ëª¨ë“  íŠ¸ëœì­ì…˜ì—ì„œ ë³¼ ìˆ˜ ìˆìŒ
- ì˜êµ¬ ì €ì¥
- rollback ë¶ˆê°€
```

### ì‹¤ë¬´ ì˜ˆì œ: JPQL ì‚¬ìš© ì „ flush

```java
@Transactional
public void jpqlExample() {
    // ì‹ ê·œ ì‚¬ìš©ì ì €ì¥
    User newUser = new User("ì‹ ê·œìœ ì €");
    em.persist(newUser);  // SQL ì €ì¥ì†Œì—ë§Œ ìˆìŒ
    
    // JPQLì€ ìë™ flush ë°œìƒ
    List<User> users = em.createQuery(
        "SELECT u FROM User u WHERE u.name LIKE :name", 
        User.class)
        .setParameter("name", "ì‹ ê·œ%")
        .getResultList();
    // JPQL ì‹¤í–‰ ì „ ìë™ìœ¼ë¡œ flush!
    // ê·¸ë˜ì„œ newUserë„ ì¡°íšŒë¨
}
```

---

## 6. @Transactional ë™ì‘ ì›ë¦¬

### ì „ì²´ íë¦„

```java
@Transactional
public void saveUser() {
    // ì‹¤ì œ ë©”ì„œë“œ
}

// ì‹¤ì œë¡œëŠ” ì´ë ‡ê²Œ ë™ì‘ (AOP):
public void saveUser() {
    // === 1. ë©”ì„œë“œ ì‹œì‘ ì „ ===
    TransactionManager.begin();  // íŠ¸ëœì­ì…˜ ì‹œì‘
    EntityManager em = create();  // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒì„±
    
    try {
        // === 2. ì‹¤ì œ ë©”ì„œë“œ ì‹¤í–‰ ===
        
        // === 3. ì •ìƒ ì¢…ë£Œ ===
        em.flush();   // SQL ì €ì¥ì†Œ â†’ DB
        tx.commit();  // ì˜êµ¬ ë°˜ì˜
        
    } catch (Exception e) {
        // === 4. ì˜ˆì™¸ ë°œìƒ ===
        tx.rollback();  // ë¡¤ë°±
        throw e;
    } finally {
        em.close();  // ì •ë¦¬
    }
}
```

### ì‹¤ë¬´ ì˜ˆì œ: ìë™ ì»¤ë°‹

```java
@Service
public class OrderService {
    
    @Transactional
    public void processOrder(Long orderId) {
        Order order = orderRepository.findById(orderId).get();
        
        order.setStatus(OrderStatus.PROCESSING);
        // SQL ì €ì¥ì†Œì— UPDATE ì¶”ê°€
        
        payment.charge(order.getAmount());
        
        order.setStatus(OrderStatus.PAID);
        // SQL ì €ì¥ì†Œì— UPDATE ì¶”ê°€
        
        // ë©”ì„œë“œ ì¢…ë£Œ ì‹œ ìë™ìœ¼ë¡œ:
        // 1. em.flush() - UPDATE 2ë²ˆ ì‹¤í–‰
        // 2. tx.commit() - ì˜êµ¬ ë°˜ì˜
    }
}
```

### ì˜ˆì™¸ ë°œìƒ ì‹œ ë¡¤ë°±

```java
@Transactional
public void rollbackExample() {
    User user = new User("í™ê¸¸ë™");
    em.persist(user);
    
    Order order = new Order();
    em.persist(order);
    
    throw new RuntimeException("ì—ëŸ¬!");
    
} // ìë™ìœ¼ë¡œ rollback
  // user, order ëª¨ë‘ ì €ì¥ ì•ˆë¨
```

---

## 7. íŠ¸ëœì­ì…˜ ì „íŒŒ(Propagation)

### REQUIRED (ê¸°ë³¸ê°’) - ê°€ì¥ ë§ì´ ì‚¬ìš©

```java
@Service
public class OrderService {
    
    @Transactional  // Transaction A ì‹œì‘
    public void createOrder() {
        Order order = new Order();
        em.persist(order);
        
        userService.updatePoint();  // Transaction A ì°¸ì—¬
        
        // í•¨ê»˜ ì»¤ë°‹ ë˜ëŠ” í•¨ê»˜ ë¡¤ë°±
    }
}

@Service
public class UserService {
    
    @Transactional(propagation = Propagation.REQUIRED)
    public void updatePoint() {
        // ê¸°ì¡´ íŠ¸ëœì­ì…˜ A ì‚¬ìš©
        User user = em.find(User.class, 1L);
        user.addPoint(100);
    }
}
```

### REQUIRES_NEW - ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜

```java
@Transactional
public void createOrder() {
    Order order = new Order();
    em.persist(order);
    
    logService.log("ì£¼ë¬¸ ìƒì„±");  // ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜
    
    throw new RuntimeException("ì£¼ë¬¸ ì‹¤íŒ¨!");
}

@Transactional(propagation = Propagation.REQUIRES_NEW)
public void log(String message) {
    Log log = new Log(message);
    em.persist(log);
    
} // ì¦‰ì‹œ ì»¤ë°‹! ì£¼ë¬¸ ì‹¤íŒ¨í•´ë„ ë¡œê·¸ëŠ” ë‚¨ìŒ
```

### ì‹¤ë¬´ ì˜ˆì œ: ì—ëŸ¬ ë¡œê·¸ëŠ” ë¬´ì¡°ê±´ ì €ì¥

```java
@Service
public class PaymentService {
    
    @Autowired
    private LogService logService;
    
    @Transactional
    public void processPayment(Long orderId) {
        try {
            Order order = orderRepository.findById(orderId).get();
            payment.charge(order.getAmount());
            order.setStatus("PAID");
            
        } catch (Exception e) {
            // ì‹¤íŒ¨ ë¡œê·¸ëŠ” ë¬´ì¡°ê±´ ë‚¨ê¹€!
            logService.logError(orderId, e);
            throw e;
        }
    }
}

@Service
public class LogService {
    
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void logError(Long orderId, Exception e) {
        ErrorLog log = new ErrorLog(orderId, e.getMessage());
        em.persist(log);
        
        // ë…ë¦½ì ìœ¼ë¡œ ì»¤ë°‹ë¨!
        // ê²°ì œëŠ” ì‹¤íŒ¨í•´ë„ ë¡œê·¸ëŠ” ì €ì¥ë¨
    }
}
```

### ì „íŒŒ íƒ€ì… ë¹„êµ

| Propagation | ì˜ë¯¸ | ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ |
|------------|------|--------------|
| REQUIRED | ìˆìœ¼ë©´ ì°¸ì—¬, ì—†ìœ¼ë©´ ìƒì„± | ê¸°ë³¸ê°’, ëŒ€ë¶€ë¶„ì˜ ê²½ìš° |
| REQUIRES_NEW | í•­ìƒ ìƒˆë¡œ ìƒì„± | ë¡œê·¸, ë°°ì¹˜ ì²˜ë¦¬ |
| SUPPORTS | ìˆìœ¼ë©´ ì°¸ì—¬, ì—†ì–´ë„ OK | ì½ê¸° ì „ìš© |
| MANDATORY | ë°˜ë“œì‹œ ìˆì–´ì•¼ í•¨ | ì•ˆì „ì¥ì¹˜ |
| NOT_SUPPORTED | íŠ¸ëœì­ì…˜ ì—†ì´ ì‹¤í–‰ | ì™¸ë¶€ API í˜¸ì¶œ |
| NEVER | íŠ¸ëœì­ì…˜ ìˆìœ¼ë©´ ì—ëŸ¬ | ì—„ê²©í•œ ì œì•½ |

---

## 8. LazyInitializationException í•´ê²°

### ë¬¸ì œ ë°œìƒ

```java
@Service
public class OrderService {
    
    @Transactional
    public Order getOrder(Long id) {
        return orderRepository.findById(id).get();
    } // â† íŠ¸ëœì­ì…˜ ì¢…ë£Œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‹«í˜
}

@RestController
public class OrderController {
    
    @GetMapping("/orders/{id}")
    public OrderDto getOrder(@PathVariable Long id) {
        Order order = orderService.getOrder(id);
        
        // ğŸ’¥ LazyInitializationException!
        String userName = order.getUser().getName();
    }
}
```

### í•´ê²° 1: Fetch Join (ê°€ì¥ ì¶”ì²œ!)

```java
@Repository
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    @Query("SELECT o FROM Order o " +
           "JOIN FETCH o.user " +
           "JOIN FETCH o.product " +
           "WHERE o.id = :id")
    Optional<Order> findByIdWithDetails(@Param("id") Long id);
}

@Transactional
public Order getOrder(Long id) {
    // User, Product í•¨ê»˜ ì¡°íšŒë¨!
    return orderRepository.findByIdWithDetails(id)
        .orElseThrow();
}
```

### í•´ê²° 2: DTO ë³€í™˜ (ì¶”ì²œ!)

```java
@Service
public class OrderService {
    
    @Transactional(readOnly = true)
    public OrderDto getOrderDto(Long id) {
        Order order = orderRepository.findByIdWithDetails(id)
            .orElseThrow();
        
        // âœ… íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ DTO ë³€í™˜!
        return OrderDto.from(order);
    }
}

public class OrderDto {
    private Long id;
    private String orderNumber;
    private String userName;
    private String productName;
    
    public static OrderDto from(Order order) {
        return new OrderDto(
            order.getId(),
            order.getOrderNumber(),
            order.getUser().getName(),     // âœ… OK
            order.getProduct().getName()   // âœ… OK
        );
    }
}
```

### í•´ê²° 3: @EntityGraph

```java
@Repository
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    @EntityGraph(attributePaths = {"user", "product"})
    Optional<Order> findById(Long id);
}
```

### ì‹¤ë¬´ ì˜ˆì œ: OSIV ë„ê³  ì‚¬ìš©í•˜ê¸°

```yaml
# application.yml
spring:
  jpa:
    open-in-view: false  # â† ì„±ëŠ¥ì„ ìœ„í•´ ë„ê¸°!
```

```java
@Service
public class OrderService {
    
    @Transactional(readOnly = true)
    public List<OrderDto> getOrders() {
        List<Order> orders = orderRepository.findAllWithUser();
        
        // âœ… íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ DTO ë³€í™˜
        return orders.stream()
            .map(OrderDto::from)
            .collect(Collectors.toList());
    }
}

@Repository
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    @Query("SELECT o FROM Order o JOIN FETCH o.user")
    List<Order> findAllWithUser();
}
```

---

## ğŸ¯ ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì„±ëŠ¥ ìµœì í™”
- [ ] N+1 ë¬¸ì œ í™•ì¸ (Fetch Join ì‚¬ìš©)
- [ ] ë¶ˆí•„ìš”í•œ EAGER ë¡œë”© ì œê±°
- [ ] ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ flush/clear
- [ ] @Transactional(readOnly = true) í™œìš©

### ì•ˆì •ì„±
- [ ] LazyInitializationException ë°©ì§€ (DTO ë³€í™˜)
- [ ] OSIV false ì„¤ì •
- [ ] ë™ì‹œì„± ì œì–´ (ë‚™ê´€ì /ë¹„ê´€ì  ë½)
- [ ] íŠ¸ëœì­ì…˜ ë²”ìœ„ ì ì ˆíˆ ì„¤ì •

### ì½”ë“œ í’ˆì§ˆ
- [ ] Entityë¥¼ Controllerì—ì„œ ì§ì ‘ ë°˜í™˜ ê¸ˆì§€
- [ ] Serviceì—ì„œ DTO ë³€í™˜
- [ ] ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ ì‘ì„±
- [ ] @Transactional ëˆ„ë½ í™•ì¸

---

## ğŸ“Œ í•µì‹¬ ìš”ì•½

```java
// 1. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ = ì—”í‹°í‹° ê´€ë¦¬ í™˜ê²½
@Transactional
public void example() {
    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìƒì„±
    
    User user = em.find(User.class, 1L);  // 1ì°¨ ìºì‹œ, ìŠ¤ëƒ…ìƒ· ì €ì¥
    user.setName("ë³€ê²½");  // ë³€ê²½ ê°ì§€
    
    // ì»¤ë°‹ ì‹œ: flush â†’ commit
}

// 2. persist = JPAì—ê²Œ ê´€ë¦¬ ìš”ì²­
em.persist(user);  // ì˜ì† ìƒíƒœë¡œ ì „í™˜

// 3. flush = DB ì „ì†¡ (ì„ì‹œ)
em.flush();  // ì¿¼ë¦¬ ì‹¤í–‰, í•˜ì§€ë§Œ rollback ê°€ëŠ¥

// 4. commit = ì˜êµ¬ ë°˜ì˜
tx.commit();  // í™•ì •, rollback ë¶ˆê°€

// 5. DTO ë³€í™˜ìœ¼ë¡œ LazyInitializationException ë°©ì§€
@Transactional
public OrderDto getOrder(Long id) {
    Order order = repository.findByIdWithDetails(id);
    return OrderDto.from(order);  // íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ë³€í™˜!
}
```