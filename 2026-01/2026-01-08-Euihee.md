# Spring 7 Null-safety κ³µμ‹ : JSpecifyλ€?

## JSpecifyλ€?

- JSpecifyλ” **Java νƒ€μ… μ‹μ¤ν…μ— nullness contractλ¥Ό λ…μ‹μ μΌλ΅ ν‘ν„**ν•κΈ° μ„ν• ν‘μ¤€ μ–΄λ…Έν…μ΄μ… μ„ΈνΈ
- Spring Framework 7λ¶€ν„° **JSpecify μ–΄λ…Έν…μ΄μ…μ„ κ³µμ‹ μ±„νƒ**
- JSpecify + μ •μ  λ¶„μ„ λ„κµ¬(NullAway λ“±)λ¥Ό ν†µν•΄ **μ»΄νμΌ νƒ€μ„ null-safety ν™•λ³΄ κ°€λ¥**
- λ°νƒ€μ„ NPE λ°©μ–΄κ°€ μ•„λ‹λΌ, **μ½”λ“ μ‘μ„± λ‹¨κ³„μ—μ„ null μ¤λ¥λ¥Ό μ κ±°ν•λ” κ²ƒμ΄ λ©μ **

---

## JSpecify μ£Όμ” κΈ°λ¥

### 1. κΈ°μ΅΄ Null-safety annotation λΉ„κµ

#### `@Nullable (jakarta.annotation)`

- νƒ€μ…μ΄ nullμΌ μ μμμ„ ν‘ν„
- μ£Ό μ©λ„: IDE ννΈ, μ ν•μ μΈ μ •μ  λ¶„μ„
- **TYPE_USEκ°€ μ•„λ‹**
    - μ λ„¤λ¦­, λ°°μ—΄, μ¤‘μ²© νƒ€μ…μ nullability ν‘ν„ λ¶κ°€
- Kotlinκ³Όμ νΈν™μ„±μ΄ λ–¨μ–΄μ§

---

#### `@NotNull (jakarta.validation.constraints)`

- Bean Validation μ©λ„ (μ…λ ¥κ°’ κ²€μ¦)
- μ •μ  λ¶„μ„ λ©μ  μ•„λ‹
- Validation chain μ‹¤ν–‰ β†’ **λ°νƒ€μ„ μ¤λ²„ν—¤λ“ μ΅΄μ¬**
- NPEλ¥Ό μ‚¬μ „μ— λ§‰λ” μ©λ„κ°€ μ•„λ‹λΌ **validation μ‹¤ν¨λ¥Ό μ΅λ” μ©λ„**

---

#### `@Nonnull / @NonNull (Spring)`

- Spring API κ³„μ•½μ© non-null ν‘ν„
- Springμ κΈ°μ΅΄ null λ¶„μ„ μ „λµ(@NonNullApi κΈ°λ°)μ€ **deprecated**
- JSR-305 κ³„μ—΄ κΈ°λ° λ¬Έμ 
    - split-package
    - μ λ„¤λ¦­Β·λ°°μ—΄ nullability ν‘ν„ λ¶κ°€
    - Kotlinμ—μ„ platform type λ¬Έμ  λ°μƒ

---

#### `@NonNull (Lombok)`

- νλΌλ―Έν„°Β·μƒμ„±μμ— **λ°νƒ€μ„ null μ²΄ν¬ μ½”λ“ μ‚½μ…**
- λ°νƒ€μ„ λ°©μ–΄μ© β†’ μ»΄νμΌ νƒ€μ„ null-safety μ•„λ‹
- μ λ„¤λ¦­ νƒ€μ… μΈμμ—λ” μλ―Έ μ—†μ
- Lombok μμ΅΄μ„± μ¦κ°€
- **λΉλ“ νƒ€μ„μ— μ΅νμ§€ μ•κ³  λ°νƒ€μ„μ—μ„λ§ μ¤λ¥ λ°μƒ**

---

π‘‰ κ³µν†µ λ¬Έμ  μ”μ•½
- Kotlin νΈν™μ„± λ¬Έμ 
- μ λ„¤λ¦­Β·λ°°μ—΄ nullabilityλ¥Ό νƒ€μ… μ‹μ¤ν…μ— ν‘ν„ λ¶κ°€

---

### 2. Optionalμ€?

- μ£Ό μ‚¬μ©μ²: **λ°ν™κ°’**
- ν•„λ“λ‚ νλΌλ―Έν„°μ— μ‚¬μ© μ‹
    - κ°€λ…μ„± μ €ν•
    - κ°μ²΄ λν•‘μΌλ΅ μΈν• μ¶”κ°€ κ°μ²΄ μƒμ„± λΉ„μ© λ°μƒ
    - λ‚¨λ° μ‹ μ½”λ“ λ³µμ΅λ„ μ¦κ°€
- null-safety annotationκ³Ό λ©μ μ΄ λ‹¤λ¦„

π‘‰ **JSpecify + Optionalμ„ μ—­ν• μ— λ§κ² μ΅°ν•©ν•΄μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ κ¶μ¥**

---

### 3. JSpecifyκ°€ μ κ³µν•λ” κ²ƒ

- `@NullMarked`
- `@NullUnmarked`
- `@Nullable`
- `@Nonnull` (μ κ³µλμ§€λ§ **μ‚¬μ© λΉ„κ¶μ¥**)

νΉμ§•:
- TYPE_USE κΈ°λ° β†’ μ λ„¤λ¦­, λ°°μ—΄ λ“± **μ„Έλ°€ν• nullability ν‘ν„ κ°€λ¥**
- Kotlinκ³Ό μ™„μ „ νΈν™
- μ •μ  λ¶„μ„ λ„κµ¬(NullAway, Checker Framework λ“±)μ™€ μ—°λ™ κ°€λ¥
- λ°νƒ€μ„ μ¤λ²„ν—¤λ“ μ—†μ
- Java ν‘μ¤€ μ–΄λ…Έν…μ΄μ… μ„ΈνΈ
- Spring 7λ¶€ν„° λ‚΄μ¥
- **ν•„λ“ μμ²΄κ°€ μ•„λ‹λΌ, νƒ€μ…μ nullabilityλ¥Ό ν‘ν„**

---

### μ¶”μ² μ‚¬μ© μ΅°ν•©

- JSpecify κ³µμ‹ κ¶μ¥ μ „λµ
    - **default non-null**
    - `@NullMarked` + ν•„μ”ν• κ³³μ—λ§ `@Nullable`
- `@Nonnull` + `@NullUnmarked` μ΅°ν•©λ„ κ°€λ¥ν•λ‚ **κ¶μ¥λμ§€ μ•μ**
- ν¨ν‚¤μ§€ λ‹¨μ„λ΅ `@NullMarked` μ μ© ν›„
    - IDE κ²½κ³ 
    - NullAway λΉλ“ νƒ€μ„ κ²€μ¦
- λ€κ·λ¨ ν”„λ΅μ νΈλ„ **μ μ§„μ  μ μ© κ°€λ¥ (λ³΄ν†µ 2~3μ£Ό λ‚΄ μ •λ¦¬ κ°€λ¥)**

---

## JSpecify ν™μ©λ²•

### κΈ°μ΅΄ Lombok `@NonNull`

- λ³„λ„ μ„¤μ • μ—†μ΄ Lombokμ— μμ΅΄
- Lombok `@NonNull`μ€ **μ»΄νμΌλ¬ νƒ€μ… μ‹μ¤ν…μ΄ μ΄ν•΄ν•λ” null-safetyκ°€ μ•„λ‹**
- ν•„λ“/νλΌλ―Έν„°/λ¦¬ν„΄ **μ„ μ–Έ μ„μΉ(target)** μ— λ¶™λ”
    - λ°νƒ€μ„ μ²΄ν¬
    - IDE ννΈ
- μ λ„¤λ¦­ νƒ€μ… μΈμ(`List<String>`μ `String`)μ—λ” μλ―Έ μ—†μ

π‘‰lombokμ€ μλ―Έ μλ” κ²½μ°λ” μ•„λ λ‘ κ°€μ§€λΏ:

```html
@NonNull List<String>   // Listλ” non-null, μ”μ†(String)λ” nullable
List<String>            // List, String λ‘ λ‹¤ nullable
```

π‘‰ν¨ν‚¤μ§€μ— @NullMarkedκ°€ μλ” κ²½μ° :
```html
List<String>                     // List, String λ‘ λ‹¤ non-null
List<@Nullable String>           // String μ”μ†λ§ nullable
@Nullable List<String>           // Listλ§ nullable
@Nullable List<@Nullable String> // List, String λ‘ λ‹¤ nullable
```
= Lombok @NonNullμ€ λ°νƒ€μ„ λ°©μ–΄μ€κ³ , JSpecifyλ” νƒ€μ… μ‹μ¤ν…μ— nullμ„ λ¨λΈλ§ν•λ” ν‘μ¤€μ΄λ‹¤.

π‘‰ν¨ν‚¤μ§€μ— @NullMarked λ¶™μ΄κΈ°
- package-info.javaμ— μ„ μ–Έ
- ν•΄λ‹Ή ν¨ν‚¤μ§€ ν•μ„ μ „μ²΄μ— default non-null κ·μΉ™ μ μ©
- μ—¬κΈ°μ„λ¶€ν„° μ½”λ“μ null-safety κΈ°μ¤€μ΄ λ°”λ€
```java
// src/main/java/com/example/project/package-info.java

@org.jspecify.annotations.NullMarked
package com.example.project;
```

## μΆ‹μ€ μ 

### as-is
```java
List<Order> orders;
```
- ordersκ°€ nullμΈμ§€, empty listμΈμ§€ μ½”λ“λ§ λ³΄κ³  νλ‹¨ λ¶κ°€
- νΈμ¶λ¶€μ—μ„ ν•­μƒ null μ²΄ν¬ ν•„μ”
- λ°©μ–΄ μ½”λ“ λ„λ½ μ‹ λ°νƒ€μ„ NPE λ°μƒ

### to-be
```java
List<Order> orders;
```
- ordersλ” μ λ€ null μ•„λ‹
- empty listμΌ μλ§ μμ
- μ»΄νμΌλ¬ + μ •μ  λ¶„μ„ λ„κµ¬(NullAway λ“±)κ°€ λ³΄μ¥

= λ°νƒ€μ„ NPE λ°μƒ κ°€λ¥μ„± λ€ν­ κ°μ†


## μ£Όμ ν•  μ 
- Entityλ” μƒνƒ λ¨λΈ μ΄λΌ, μƒνƒ λ³€ν™” μ¦μ, ORM ν”„λ΅μ‹ νΉμ„± μ΅΄μ¬
- @NullMarkedλ” DTO / Service / Adapter λ μ΄μ–΄ μ„μ£Ό μ μ© κ¶μ¥
- κ³ λ΅ , @NullMarked Entityμ—λ” μµμ†ν™”ν•κ±°λ‚ λ―Έμ μ© κ¶μ¥

- μλ―Έ μ—†λ” Optional + JSpecify μ΅°ν•© (β κ°λ…Έλ‹µ 3ν•μ )
```html
Optional<User> user = null;
Optional<@Nullable User>
List<Optional<User>>
```
